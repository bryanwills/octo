{"version":3,"file":"lists.b465ff74.6f628e30.js","sources":["../../node_modules/ink-mde/dist/lists.b465ff74.js"],"sourcesContent":["import { syntaxTree } from '@codemirror/language';\nimport { StateField, RangeSet } from '@codemirror/state';\nimport { ViewPlugin, EditorView, Decoration } from '@codemirror/view';\n\nconst dotWidget = () => {\n  return {\n    compare: (_other) => {\n      return false;\n    },\n    destroy: () => {\n    },\n    eq: (_other) => {\n      return false;\n    },\n    estimatedHeight: -1,\n    ignoreEvent: () => true,\n    toDOM: () => {\n      const span = document.createElement(\"span\");\n      span.innerHTML = \"&#x2022;\";\n      span.setAttribute(\"aria-hidden\", \"true\");\n      return span;\n    },\n    updateDOM: () => false\n  };\n};\nconst taskWidget = (isChecked) => {\n  return {\n    compare: (other) => {\n      return other.isChecked === isChecked;\n    },\n    destroy: () => {\n    },\n    eq: (other) => {\n      return other.isChecked === isChecked;\n    },\n    estimatedHeight: -1,\n    ignoreEvent: () => false,\n    isChecked,\n    toDOM: () => {\n      const input = document.createElement(\"input\");\n      input.setAttribute(\"aria-hidden\", \"true\");\n      input.className = \"ink-mde-task-toggle\";\n      input.type = \"checkbox\";\n      input.checked = isChecked;\n      return input;\n    },\n    updateDOM: () => false\n  };\n};\nconst hasOverlap = (x1, x2, y1, y2) => {\n  return Math.max(x1, y1) <= Math.min(x2, y2);\n};\nconst isCursorInRange = (state, from, to) => {\n  return state.selection.ranges.some((range) => {\n    return hasOverlap(from, to, range.from, range.to);\n  });\n};\nconst toggleTask = (view, position) => {\n  const before = view.state.sliceDoc(position + 2, position + 5);\n  view.dispatch({\n    changes: {\n      from: position + 2,\n      to: position + 5,\n      insert: before === \"[ ]\" ? \"[x]\" : \"[ ]\"\n    }\n  });\n  return true;\n};\nconst lists = () => {\n  const dotDecoration = () => Decoration.replace({\n    widget: dotWidget()\n  });\n  const taskDecoration = (isChecked) => Decoration.replace({\n    widget: taskWidget(isChecked)\n  });\n  const decorate = (state) => {\n    const widgets = [];\n    syntaxTree(state).iterate({\n      enter: ({ type, from, to }) => {\n        if (type.name === \"ListMark\" && !isCursorInRange(state, from, to)) {\n          const task = state.sliceDoc(to + 1, to + 4);\n          if (![\"[ ]\", \"[x]\"].includes(task)) {\n            const marker = state.sliceDoc(from, to);\n            if ([\"-\", \"*\"].includes(marker)) {\n              widgets.push(dotDecoration().range(from, to));\n            }\n          }\n        }\n        if (type.name === \"TaskMarker\" && !isCursorInRange(state, from - 2, to)) {\n          const task = state.sliceDoc(from, to);\n          widgets.push(taskDecoration(task === \"[x]\").range(from - 2, to));\n        }\n      }\n    });\n    return widgets.length > 0 ? RangeSet.of(widgets) : Decoration.none;\n  };\n  const viewPlugin = ViewPlugin.define(() => ({}), {\n    eventHandlers: {\n      mousedown: (event, view) => {\n        const target = event.target;\n        if (target?.nodeName === \"INPUT\" && target.classList.contains(\"ink-mde-task-toggle\")) {\n          return toggleTask(view, view.posAtDOM(target));\n        }\n      }\n    }\n  });\n  const stateField = StateField.define({\n    create(state) {\n      return decorate(state);\n    },\n    update(_references, { state }) {\n      return decorate(state);\n    },\n    provide(field) {\n      return EditorView.decorations.from(field);\n    }\n  });\n  return [\n    viewPlugin,\n    stateField\n  ];\n};\n\nexport { lists };\n//# sourceMappingURL=lists.b465ff74.js.map\n"],"names":[],"mappings":"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"}