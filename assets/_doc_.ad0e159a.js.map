{"version":3,"file":"_doc_.ad0e159a.js","sources":["../../pages/docs/[doc].vue"],"sourcesContent":["<template>\n  <Editor\n    ref=\"editable\"\n    :appearance=\"appearance\"\n    :doc=\"doc\"\n    :initialFocus=\"initialFocus\"\n    :initialSelections=\"initialSelections\"\n    :readonly=\"readonly\"\n    :settings=\"settings\"\n    @input=\"input\"\n  />\n</template>\n\n<script>\nimport { defineComponent, inject } from 'vue'\nimport Editor from '/components/Editor.vue'\nimport { setTitle } from '/src/common/title'\nimport { fetchSharedDoc } from '/src/firebase/firestore'\nimport Doc, { unpack } from '/src/models/doc'\nimport { ADD_DOCUMENT, EDIT_DOCUMENT, SET_DOCUMENT } from '/src/store/actions'\n\nconst formatTags = (tags, delimiter = ', ') => {\n  return tags.map((tag) => `#${tag}`).join(delimiter)\n}\n\nexport default defineComponent({\n  components: {\n    Editor,\n  },\n  props: {\n    docId: String,\n    initialFocus: {\n      type: String,\n      default: () => 'any',\n      validator: (position) => ['any', 'start', 'end'].includes(position),\n    },\n    initialSelections: {\n      type: Array,\n    },\n    readonly: {\n      type: Boolean,\n    },\n  },\n  data() {\n    return {\n      editor: null,\n      placeholder: new Doc({ text: formatTags(this.$store.state.context.tags, ' ') }),\n    }\n  },\n  setup() {\n    const appearance = inject('appearance')\n\n    return {\n      appearance: appearance.value === 'october' ? 'dark' : appearance.value,\n    }\n  },\n  watch: {\n    tags: {\n      deep: true,\n      handler() {\n        this.updateTitle()\n      },\n    },\n    header() {\n      this.updateTitle()\n    },\n  },\n  computed: {\n    appearance() {\n      if (this.$store.state.settings.theme === 'october') { return 'dark' }\n\n      return this.$store.state.settings.theme\n    },\n    doc() {\n      return this.$store.getters.decrypted.find((doc) => doc.id === this.docId) || this.placeholder\n    },\n    settings() {\n      return this.$store.state.settings.editor\n    },\n    tags() {\n      return this.doc.tags\n    },\n    header() {\n      return this.doc.headers[0]\n    },\n  },\n  methods: {\n    input(text) {\n      if (!this.readonly) {\n        // ReadOnly mode means we are viewing a shared doc.\n        // Todo: Create a new view for shared docs, and store shared docs in a new collection.\n        if (this.docId) {\n          this.$store.commit(EDIT_DOCUMENT, { id: this.doc.id, text })\n        } else {\n          this.$store.commit(ADD_DOCUMENT, new Doc({ id: this.doc.id, text }))\n\n          this.$router.replace({\n            path: `/docs/${this.doc.id}`,\n            query: {\n              p: true,\n            },\n          })\n        }\n      }\n    },\n    async findSharedDocument() {\n      const docRef = await fetchSharedDoc({ docId: this.$route.params.docId })\n      const serverDoc = docRef.data()\n      const packed = {\n        ...serverDoc,\n        id: serverDoc.id || serverDoc.clientId,\n        firebaseId: docRef.id,\n        textKey: serverDoc.textKey || serverDoc.dataKey,\n        createdAt: serverDoc.createdAt ? serverDoc.createdAt.toDate() : null,\n        discardedAt: serverDoc.discardedAt ? serverDoc.discardedAt.toDate() : null,\n        updatedAt: serverDoc.updatedAt ? serverDoc.updatedAt.toDate() : null,\n        touchedAt: serverDoc.touchedAt ? serverDoc.touchedAt.toDate() : null,\n        syncedAt: serverDoc.syncedAt.toDate(),\n      }\n\n      return unpack(packed, { privateKey: this.$store.state.settings.crypto.privateKey })\n    },\n    updateTitle() {\n      setTitle(this.header || formatTags(this.doc.tags))\n    },\n  },\n  beforeRouteUpdate(to, _from, next) {\n    if (to.name === 'docs-doc') {\n      this.$store.dispatch(SET_DOCUMENT, { id: to.params.docId })\n    }\n\n    next()\n  },\n  async mounted() {\n    this.updateTitle()\n\n    // might want to pass another prop to represent 'shared' since readonly might have multiple use cases\n    if (this.readonly) {\n      this.placeholder = await this.findSharedDocument()\n    }\n  },\n})\n</script>\n"],"names":["Editor","_createBlock"],"mappings":"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"}