{"version":3,"file":"images.0bde9a43.ff8d3ddb.js","sources":["../../node_modules/ink-mde/dist/images.0bde9a43.js"],"sourcesContent":["import { syntaxTree } from '@codemirror/language';\nimport { StateField, RangeSet } from '@codemirror/state';\nimport { EditorView, Decoration, WidgetType } from '@codemirror/view';\n\nclass ImageWidget extends WidgetType {\n  url;\n  constructor({ url }) {\n    super();\n    this.url = url;\n  }\n  eq(imageWidget) {\n    return imageWidget.url === this.url;\n  }\n  toDOM() {\n    const container = document.createElement(\"div\");\n    const backdrop = container.appendChild(document.createElement(\"div\"));\n    const figure = backdrop.appendChild(document.createElement(\"figure\"));\n    const image = figure.appendChild(document.createElement(\"img\"));\n    container.setAttribute(\"aria-hidden\", \"true\");\n    container.className = \"cm-image-container\";\n    backdrop.className = \"cm-image-backdrop\";\n    figure.className = \"cm-image-figure\";\n    image.className = \"cm-image-img\";\n    image.src = this.url;\n    container.style.paddingBottom = \"0.5rem\";\n    container.style.paddingTop = \"0.5rem\";\n    backdrop.classList.add(\"cm-image-backdrop\");\n    backdrop.style.borderRadius = \"var(--ink-internal-border-radius)\";\n    backdrop.style.display = \"flex\";\n    backdrop.style.alignItems = \"center\";\n    backdrop.style.justifyContent = \"center\";\n    backdrop.style.overflow = \"hidden\";\n    backdrop.style.maxWidth = \"100%\";\n    figure.style.margin = \"0\";\n    image.style.display = \"block\";\n    image.style.maxHeight = \"var(--ink-internal-block-max-height)\";\n    image.style.maxWidth = \"100%\";\n    image.style.width = \"100%\";\n    return container;\n  }\n}\nconst images = () => {\n  const imageRegex = /!\\[.*?\\]\\((?<url>.*?)\\)/;\n  const imageDecoration = (imageWidgetParams) => Decoration.widget({\n    widget: new ImageWidget(imageWidgetParams),\n    side: -1,\n    block: true\n  });\n  const decorate = (state) => {\n    const widgets = [];\n    syntaxTree(state).iterate({\n      enter: ({ type, from, to }) => {\n        if (type.name === \"Image\") {\n          const result = imageRegex.exec(state.doc.sliceString(from, to));\n          if (result && result.groups && result.groups.url)\n            widgets.push(imageDecoration({ url: result.groups.url }).range(state.doc.lineAt(from).from));\n        }\n      }\n    });\n    return widgets.length > 0 ? RangeSet.of(widgets) : Decoration.none;\n  };\n  const imagesField = StateField.define({\n    create(state) {\n      return decorate(state);\n    },\n    update(images2, transaction) {\n      if (transaction.docChanged)\n        return decorate(transaction.state);\n      return images2.map(transaction.changes);\n    },\n    provide(field) {\n      return EditorView.decorations.from(field);\n    }\n  });\n  return [\n    imagesField\n  ];\n};\n\nexport { images };\n//# sourceMappingURL=images.0bde9a43.js.map\n"],"names":[],"mappings":";;;;;;;;;AAIA,MAAM,oBAAoB,WAAW;AAAA,EAEnC,YAAY,EAAE,OAAO;AACnB;AAFF;AAGE,SAAK,MAAM;AAAA,EACZ;AAAA,EACD,GAAG,aAAa;AACd,WAAO,YAAY,QAAQ,KAAK;AAAA,EACjC;AAAA,EACD,QAAQ;AACN,UAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,UAAM,WAAW,UAAU,YAAY,SAAS,cAAc,KAAK,CAAC;AACpE,UAAM,SAAS,SAAS,YAAY,SAAS,cAAc,QAAQ,CAAC;AACpE,UAAM,QAAQ,OAAO,YAAY,SAAS,cAAc,KAAK,CAAC;AAC9D,cAAU,aAAa,eAAe,MAAM;AAC5C,cAAU,YAAY;AACtB,aAAS,YAAY;AACrB,WAAO,YAAY;AACnB,UAAM,YAAY;AAClB,UAAM,MAAM,KAAK;AACjB,cAAU,MAAM,gBAAgB;AAChC,cAAU,MAAM,aAAa;AAC7B,aAAS,UAAU,IAAI,mBAAmB;AAC1C,aAAS,MAAM,eAAe;AAC9B,aAAS,MAAM,UAAU;AACzB,aAAS,MAAM,aAAa;AAC5B,aAAS,MAAM,iBAAiB;AAChC,aAAS,MAAM,WAAW;AAC1B,aAAS,MAAM,WAAW;AAC1B,WAAO,MAAM,SAAS;AACtB,UAAM,MAAM,UAAU;AACtB,UAAM,MAAM,YAAY;AACxB,UAAM,MAAM,WAAW;AACvB,UAAM,MAAM,QAAQ;AACpB,WAAO;AAAA,EACR;AACH;AACK,MAAC,SAAS,MAAM;AACnB,QAAM,aAAa;AACnB,QAAM,kBAAkB,CAAC,sBAAsB,WAAW,OAAO;AAAA,IAC/D,QAAQ,IAAI,YAAY,iBAAiB;AAAA,IACzC,MAAM;AAAA,IACN,OAAO;AAAA,EACX,CAAG;AACD,QAAM,WAAW,CAAC,UAAU;AAC1B,UAAM,UAAU,CAAA;AAChB,eAAW,KAAK,EAAE,QAAQ;AAAA,MACxB,OAAO,CAAC,EAAE,MAAM,MAAM,GAAE,MAAO;AAC7B,YAAI,KAAK,SAAS,SAAS;AACzB,gBAAM,SAAS,WAAW,KAAK,MAAM,IAAI,YAAY,MAAM,EAAE,CAAC;AAC9D,cAAI,UAAU,OAAO,UAAU,OAAO,OAAO;AAC3C,oBAAQ,KAAK,gBAAgB,EAAE,KAAK,OAAO,OAAO,IAAG,CAAE,EAAE,MAAM,MAAM,IAAI,OAAO,IAAI,EAAE,IAAI,CAAC;AAAA,QAC9F;AAAA,MACF;AAAA,IACP,CAAK;AACD,WAAO,QAAQ,SAAS,IAAI,SAAS,GAAG,OAAO,IAAI,WAAW;AAAA,EAClE;AACE,QAAM,cAAc,WAAW,OAAO;AAAA,IACpC,OAAO,OAAO;AACZ,aAAO,SAAS,KAAK;AAAA,IACtB;AAAA,IACD,OAAO,SAAS,aAAa;AAC3B,UAAI,YAAY;AACd,eAAO,SAAS,YAAY,KAAK;AACnC,aAAO,QAAQ,IAAI,YAAY,OAAO;AAAA,IACvC;AAAA,IACD,QAAQ,OAAO;AACb,aAAO,WAAW,YAAY,KAAK,KAAK;AAAA,IACzC;AAAA,EACL,CAAG;AACD,SAAO;AAAA,IACL;AAAA,EACJ;AACA;"}